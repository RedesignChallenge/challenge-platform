(function () {
  'use strict';

  $(function () {
    invokeStateSelectBox();
  });
})();

var stateSelectProcessFn = function (data) {
  return {
    results: _.map(data, function (state) {
      return {
        id: state.id,
        text: state.name + ' (' + state.mail_state + ')'
      }
    })
  };
};


var stateSelectAjaxOptions = {
  url: '/states/search.json',
  data: function (params) {
    return {
      search: params.term
    };
  },

  processResults: stateSelectProcessFn
};


var stateSelectOptions = {
  width: '100%',
  allowClear: true,
  multiple: true,
  minimumInputLength: 1,
  placeholder: "<%= I18n.t('devise.registrations.forms._profile.please_select_state') %>",
  ajax: stateSelectAjaxOptions
};

var invokeStateSelectBox = function () {
  $("#user_state_ids").select2(stateSelectOptions)
};