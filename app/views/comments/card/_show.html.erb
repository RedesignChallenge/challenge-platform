<div class='comment-header'>
  <div class="media media-commenter pull-left">
    <p class="timestamp"><%= "#{time_ago_in_words(comment.created_at).titleize} Ago" %></p>
    <div class="media-left">
      <% if comment.user.avatar.present? %>
        <%= image_tag(comment.user.avatar.profile.url, class: 'img-circle', style: 'width:2em') %>
      <% else %>
        <% if user_signed_in? && current_user == comment.user %>
          <span class="fa-stack fa-lg comment-user-avatar">
            <i class="fa fa-circle fa-stack-2x"></i>
            <i class="fa fa-inverse fa-stack-1x">you</i>
          </span>
        <% else %>
          <span class="fa-stack fa-lg comment-user-avatar">
            <i class="fa fa-circle fa-stack-2x" style='color:<%= comment.user.color %>'></i>
            <i class="fa fa-inverse fa-stack-1x"><%= comment.user.initials %></i>
          </span>
        <% end %>
      <% end %>
    </div>
    <div class="media-body">
      <p class='name'><%= comment.user.display_name %></p>
      <p class='title'><%= comment.user.display_organization %></p>
    </div>
  </div>

  <div class='clearfix'></div>
</div>

<div class='comment-content'>
  <% if comment.embed.present? %>
    <div class="row">
      <div class="col-sm-4">
        <%= comment.embed.html_safe %>
      </div>
      <div class="col-sm-8">
        <p class='comment-text'><%= comment.body %></p>
      </div>
    </div>
  <% else %>
    <p class='comment-text'><%= comment.body %></p>
    <% unless comment.link.blank? %>
      <p class='comment-link'><b><i class='fa fa-link'></i> Link:</b> <%= link_to truncate(comment.link, length: 150), comment.link, target: '_blank' %></p>
    <% end %>
  <% end %>
</div>

<div class="comment-actions" data-comment-id="<%= comment.id %>">
  <ul class="list-inline">
    <li><a href="#<%= "#{comment.commentable.class.to_s.downcase}-#{comment.commentable.id}-new-comment" %>" du-smooth-scroll ng-click="temporal_parent_id=<%= comment.id %>"><i class="fa fa-reply fa-flip-horizontal"></i> <span class='hidden-xs'>Reply</span></a></li>

    <li id="comment-<%= comment.id %>-like">
      <%= render partial: 'comments/card/like', locals: { comment: comment } %>
    </li>

    <% if user_signed_in? && comment.user == current_user %>
      <li>
        <%= link_to "<i class='fa fa-edit'></i> <span class='hidden-xs'>Edit</span>".html_safe, '#', 'ng-click' => "comment_#{comment.id}_edit=true", onclick: 'return false;', class: 'list-link' %>
      </li>
      <li>
        <%= link_to "<i class='fa fa-trash'></i> <span class='hidden-xs'>Delete</span>".html_safe, comment_path(comment.id), method: :delete, data: { confirm: "Are you sure you want to delete your comment?"}, class: 'list-link' %>
      </li>
    <% else %>
      <% ## TODO implement dropdown functionality for reporting %>
      <!-- <li class="dropdown" data-dropdown-id="<%= comment.id %>">
        <a id="comment-options-<%= comment.id %>" class="dropdown-toggle" data-toggle="dropdown" aria-haspopup="true" role="button" aria-expanded="false"><i class="fa fa-ellipsis-h"></i></a>
      </li> -->
    <% end %>
  </ul>
</div>