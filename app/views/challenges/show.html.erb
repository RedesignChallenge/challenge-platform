<%= render partial: 'challenges/header', cache: true %>

<div id='challenge-overview'>
  <div class='container'>
    <div class='row'>
      <div class='col-md-10 col-md-offset-1'>

        <div class='row'>
          <div class="col-sm-7">
            <p class='challenge-headline'><%= @challenge.headline.html_safe %></p>

            <p class="challenge-hashtag"><i class='fa fa-twitter'></i> <%= link_to "##{@challenge.hashtag.html_safe}", "https://twitter.com/hashtag/#{@challenge.hashtag.html_safe}", target: '_blank' %></p>
          </div>
          <div class="col-sm-5">
            <%= video_embed(@challenge.video_url) %>
          </div>
        </div>

      </div>
    </div>
  </div>
</div>

<div id='challenge-description'>
  <div class='container'>
    <div class='row'>
      <div class='col-md-10 col-md-offset-1'>

        <%= @challenge.description.html_safe if @challenge.description.present? %>

        <div class='center-block text-center'><%= link_to "Get Involved", challenge_active_stage_path(@challenge), class: 'btn btn-md btn-longer btn-rounded btn-info' %></div>

      </div>
    </div>
  </div>
</div>

<div id='challenge-details'>
  <div class='container'>
    <div class='row'>
      <div class='col-md-10 col-md-offset-1'>

        <!-- Experience Process Bubbles: START -->
        <div id='challenge-process' class='row'>
          <% if @challenge.incentive.present? %>
            <div class='col-sm-9 col-sm-offset-3'>
              <p class='text-center text-approach'><%= @challenge.incentive.html_safe %></p>    
            </div>
          <% end %>

          <% Challenge::STAGES.each_with_index do |stage, index| %>
            <div class="col-xs-6 col-sm-3" style='margin-bottom:15px'>
              <% if @challenge.stage_number == stage[:number] %>
                <%= link_to eval("challenge_#{stage[:name]}_stage_path(@challenge, @challenge.#{stage[:name]}_stage)") do %>
                  <span class="fa-stack challenge-fa-bubble fa-<%= stage[:name] %>">
                    <i class="fa fa-circle fa-stack-2x"></i>
                    <i class="fa fa-stack-1x fa-inverse <%= stage[:icon] %>"></i>
                  </span>
                <% end %>
              <% else %>
                <% if @challenge.stage_number > stage[:number] %>
                  <%= link_to eval("challenge_#{stage[:name]}_stage_path(@challenge, @challenge.#{stage[:name]}_stage)") do %>
                    <span class="fa-stack challenge-fa-bubble fa-<%= stage[:name] %> completed">
                      <i class="fa fa-circle fa-stack-2x"></i>
                      <i class="fa fa-stack-1x fa-inverse <%= stage[:icon] %>"></i>
                    </span>
                  <% end %>
                <% else %>
                  <span class="fa-stack challenge-fa-bubble fa-<%= stage[:name] %> pending">
                    <i class="fa fa-circle fa-stack-2x"></i>
                    <i class="fa fa-stack-1x fa-inverse <%= stage[:icon] %>"></i>
                  </span>
                <% end %>
              <% end %>

              <%= content_tag(:i, '', class: 'fa fa-play', style: ('color: transparent' if stage[:name] == 'solution') ) %>
              
              <div class='clearfix'></div>
              <div class="caption">
                <p class='stage'>
                  <% if @challenge.stage_number > stage[:number] %>
                    <%= link_to eval("challenge_#{stage[:name]}_stage_path(@challenge, @challenge.#{stage[:name]}_stage)"), style: 'color:#454545;font-weight:bold' do %>
                      <i class='fa fa-check'></i> <%= pluralize(eval("@challenge.#{stage[:name]}_stage.#{stage[:name].pluralize}.count"), stage[:name]).titleize %> <%= stage[:action].titleize %>
                    <% end %>
                  <% else %>
                    <%= stage[:headline] %>
                  <% end %>
                </p>
                <p class='description'><%= stage[:description] %></p>
              </div>

              <div class='stage-cta'>
                <% if @challenge.stage_number == stage[:number] %>
                  <%= link_to 'Get Set, Create!', challenge_active_stage_path(@challenge), class: 'btn btn-info btn-rounded' %>
                <% else %>
                  <% if @challenge.stage_number > stage[:number] %>
                    <p><%= link_to 'Completed', eval("challenge_#{stage[:name]}_stage_path(@challenge, @challenge.#{stage[:name]}_stage)"), class: "completed text-default" %></p>
                  <% else %>
                    <p class='pending'>Not yet active</p>
                  <% end %>
                <% end %>
              </div>
            </div>
          <% end %>
        </div>
        <!-- Experience Process Bubbles: END -->


        <div class="row">
          <div class="col-sm-4">
            <h3>The Challenge</h3>
            <p><%= @challenge.background.html_safe %></p>
          </div>
          <div class="col-sm-4">
            <h3>The Goal</h3>
            <p><%= @challenge.outcome.html_safe %></p>
          </div>
          <div class="col-sm-4">
            <h3>Your Role</h3>
            <p><%= @challenge.help.html_safe %></p>
          </div>
        </div>

      </div>
    </div>
  </div>
</div>

<div id='challenge-panel'>
  <div class='container'>
    <div class='row'>
      <div class='col-md-10 col-md-offset-1'>

        <div class="row">
          <p class="section-title">Meet Our Challenge Guides</p>
          
          <div class='col-sm-10 col-sm-offset-1 col-md-8 col-md-offset-2'>
            <p class='section-description'><%= @challenge.panel.about.html_safe %></p>
          </div>
        </div>

        <div class='row row-panelists'>
          <% @challenge.panelists.each do |panelist| %>
            <div class="col-xs-6 col-sm-3" style='margin-bottom:15px'>
              <%= link_to image_tag(panelist.avatar.profile.url, class: 'img-circle', style: 'width:50%'), '#', data: { toggle: 'modal', target: "#panelist-#{panelist.id}" } %>
              <div class="caption">
                <p class='name'><%= link_to panelist.name, "#", data: { toggle: 'modal', target: "#panelist-#{panelist.id}" } %></p>
                <p class='title'><%= panelist.title %></p>
                <p class='title'><%= panelist.organization %></p>
              </div>
            </div>
          <% end %>
        </div>

        <% @challenge.panelists.each do |panelist| %>
          <div class="modal fade" id="<%= "panelist-#{panelist.id}" %>">
            <div class="modal-dialog modal-md">
              <div class="modal-content">
                <div class="modal-header">
                  <button type="button" class="close" data-dismiss="modal">&times;</button>
                  <p class='panelist-title'>About <%= panelist.name %></p>
                </div>
                <div class='modal-body'>
                  <p class='panelist-bio'><%= panelist.bio.present? ? panelist.bio.html_safe : "Not yet provided." %></p>
                </div>
              </div>
            </div>
          </div>
        <% end %>

      </div>
    </div>
  </div>
</div>

<div id='challenge-featured'>
  <div class="container">
    <div class='row'>
      <div class='col-md-10 col-md-offset-1'>

        <p class="section-title" style='margin-bottom: 30px'> <%= @challenge.cta %> <%= link_to "Get Involved", challenge_active_stage_path(@challenge), class: 'btn btn-md btn-rounded btn-info' %></p>

        <p class="section-title">Featured contributions from <%= @challenge.title %></p>

        <div class='row'>
          <% @challenge.featured_contributions.each do |featured| %>
            <%= render file: "#{featured.class.name.pluralize.downcase}/card", cache: true, locals: eval("{ #{featured.class.name.downcase}: featured }") %>
          <% end %>
        </div>

        <div class='row'>
          <div class='col-xs-6 col-xs-offset-3 col-sm-4 col-sm-offset-4 col-md-2 col-md-offset-5'>
            <%= link_to "Show More", challenge_active_stage_path(@challenge), class: 'btn btn-block btn-rounded btn-info' %>
          </div>
        </div>

      </div>
    </div>
  </div>
</div>

<div id='challenge-invite'>
  <div class="container">
    <div class='row'>
      <div class='col-md-10 col-md-offset-1'>

        <p class="section-title-share">Know people who have something to add to this conversation?</p>

        <div class="row">
          <div class='col-sm-10 col-sm-offset-1'>
            <p class='section-description'>More people means more problems solved. Share this challenge!</p>
          </div>
        </div>

        <%= render partial: 'layouts/share_links', locals: { url: challenge_url(@challenge), title: @challenge.title.html_safe, description: @challenge.description.html_safe, hashtag: @challenge.hashtag } %>
        
      </div>
    </div>
  </div>
</div>